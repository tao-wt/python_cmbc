#!/usr/bin/envspacepythonPLY#spaceencoding:utf-8PLY__author__space=space'Chocolee'PLYimportspaceparamikoPLYimportspaceos,datetimePLYPLYclassspaceParamikoClass(object):PLYTABsspace=spaceparamiko.SSHClient()PLYTABs.load_system_host_keys()PLYTABs.set_missing_host_key_policy(paramiko.AutoAddPolicy())PLYPLYTABdefspace__init__(self,host,port,user,password):PLYTABTABself.hostspace=spacehostPLYTABTABself.portspace=spaceportPLYTABTABself.userspace=spaceuserPLYTABTABself.passwordspace=spacepasswordPLYPLYTAB#执行命令函数PLYTABdefspacecmd_run(self,cmd):PLYTABTABself.s.connect(self.host,self.port,self.user,self.password,timeout=1)PLYTABTABstdin,stdout,stderrspace=spaceself.s.exec_command(cmd)PLYTABTABcmd_resultspace=spacestdout.read(),stderr.read()PLYTABTABself.s.close()PLYPLYPLYTABdefspacecmd_runhost(self,cmd):PLYTABTABself.s.connect(self.host,self.port,self.user,self.password,timeout=1)PLYTABTABstdin,stdout,stderrspace=spaceself.s.exec_command(cmd)PLYTABTABcmd_resultspace=spacestdout.read(),stderr.read()PLYTABTABprint('\033[32;1m--------space%s\033[0mspace\033[31;1m%s\033[0mspace\033[32;1m--------\033[0m'%(self.host,cmd))PLYTABTABforspacelinespaceinspacecmd_result:PLYTABTABTABprintspaceline,PLYTABTABself.s.close()PLYTABreturnspaceTruePLYPLYPLYTABdefspacecheck_cmd(self,cmd):PLYTABTABself.s.connect(self.host,self.port,self.user,self.password,timeout=1)PLYTABTABstdin,stdout,stderrspace=spaceself.s.exec_command(cmd)PLYTABTABcmd_resultspace=spacestdout.read(),stderr.read()PLYTABTABforspacelinespaceinspacecmd_result:PLYTABTABTABreturnspacelinePLYTABTABself.s.close()PLYPLYTAB#分发文件函数PLYTABdefspaceput_file(self,file_path,remote_path):PLYTABTABfile_namespace=spaceos.path.basename(file_path)PLYTABTABtspace=spaceparamiko.Transport((self.host,self.port))PLYTABTABt.connect(username=self.user,password=self.password)PLYTABTABsftpspace=spaceparamiko.SFTPClient.from_transport(t)PLYTABTABsftp.put(file_path,'%s/%s'space%(remote_path,file_name))PLYTABTABprint('\033[31;1msendspace%s\033[0mspacetospace\033[0m\033[32;1m%s\033[0m\033[32;1mspace%sspacesucesseful.\033[0m'%(file_name,self.host,remote_path))PLYTABTABt.close()PLYPLYTAB#未测试PLYTABdefspaceget_file(self,remotepath,file_name,localpath):PLYTABTABtspace=spaceparamiko.Transport((self.host,self.port))PLYTABTABt.connect(username=self.user,password=self.password)PLYTABTABsftpspace=spaceparamiko.SFTPClient.from_transport(t)PLYTABTABsftp.get('%s/%s'%(remotepath,file_name),'%s/%s'%(localpath,file_name))PLYTABTABt.close()PLYPLYTAB#PLYTABdefspaceupload(self,local_dir,remote_dir):PLYTABTABtmp_listspace=spaceremote_dir.split('/')PLYTABTABdir_namespace=spacetmp_list[-2]PLYTABTABtry:PLYTABTABTABt=paramiko.Transport((self.host,self.port))PLYTABTABTABt.connect(username=self.user,password=self.password)PLYTABTABTABsftp=paramiko.SFTPClient.from_transport(t)PLYTABTABTAB#sftp.remove("%s"%remote_dir)PLYTABTABTAB#sftp.mkdir("%s"%remote_dir)PLYTABTABTAB#print('===============space%sspaceuploadspace%sspace==============='%(self.host,dir_name))PLYTABTABTAB#printspace'uploadspacefilespacestartspace%sspace'space%spacedatetime.datetime.now()PLYTABTABTABforspaceroot,dirs,filesspaceinspaceos.walk(local_dir):PLYTABTABTABTABforspacefilespathspaceinspacefiles:PLYTABTABTABTABTABlocal_filespace=spaceos.path.join(root,filespath)PLYTABTABTABTABTABaspace=spacelocal_file.replace(local_dir,'')PLYTABTABTABTABTABremote_filespace=spaceos.path.join(remote_dir,a)PLYTABTABTABTABTABtry:PLYTABTABTABTABTABTABsftp.put(local_file,remote_file)PLYTABTABTABTABTABexceptspaceException,e:PLYTABTABTABTABTABTABsftp.mkdir(os.path.split(remote_file)[0])PLYTABTABTABTABTABTABsftp.put(local_file,remote_file)PLYTABTABTABTABTAB#printspace"uploadspace%sspacetospaceremotespace%s"space%space(local_file,remote_file)PLYTABTABTABTABforspacenamespaceinspacedirs:PLYTABTABTABTABTABlocal_pathspace=spaceos.path.join(root,name)PLYTABTABTABTABTABaspace=spacelocal_path.replace(local_dir,'')PLYTABTABTABTABTABremote_pathspace=spaceos.path.join(remote_dir,a)PLYTABTABTABTABTABtry:PLYTABTABTABTABTABTABsftp.mkdir(remote_path)PLYTABTABTABTABTABTAB#printspace"mkdirspacepathspace%s"space%spaceremote_pathPLYTABTABTABTABTABexceptspaceException,e:PLYTABTABTABTABTABTAB#printspaceePLYTABTABTABTABTABTABpassPLYTABTABTAB#printspace'uploadspacefilespacesuccessspace%sspace'space%spacedatetime.datetime.now()PLYTABTABspacespacespace#spaceprint('\033[1;32;40m======space%sspaceuploadspace%sspace=====spaceOK\033[0m'%(self.host,dir_name))PLYTABTABTABt.close()PLYTABTABexceptspaceException,e:PLYTABTABTABprintspaceePLY
