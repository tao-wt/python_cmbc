#!/usr/bin/envspacepythonPLY#spaceencoding:utf-8PLYPLYPLYimportspacesysPLYimportspaceosPLYsys.path.append("..")PLYfromspacelib.LogicSQLClassspaceimportspace*PLYfromspacelib.ParamikoClassspaceimportspace*PLYPLYimportspacemultiprocessingPLYfromspaceoptparsespaceimportspaceOptionParserPLYimportspacetimePLYPLYdefspacehelpFunc(a,b,c,d):PLYTABprintspace"\033[32;1mForspacehelp:"PLYTABprintspace"superstar.pyspace[-aspace(Allspaceip)space-ispace(IPspaceaddress,xx1,xx2..)space-Mspace(Modulespacename)space-sspace(Superspacemode)space-cspace(start|stop)]"PLYTABprintspace"superstar.pyspace-aspace-cspacestart|stopspace--allspace--cmdspacestart|stop"PLYTABprintspace"superstar.pyspace-ispaceipaddr,[xx,xx]space-cspacestart|stopspace--ipspacex1,x2,..space--cmdspacestart|stop"PLYTABprintspace"superstar.pyspace-Mspacemodulename,[xx,xx]space-cspacestart|stopspace--Modspacemod1,mod2space--cmdspacestart|stop"PLYTABprintspace"superstar.pyspace-ispaceipaddr,[xx,xx]space-Mspacemodulename,[xx,xx]space-cspacestart|stop"PLYTABprintspace"superstar.pyspace-sspace-aspace-cspacestart|stopspace--allspace--cmdspacestart|stop"PLYTABprintspace"superstar.pyspace-sspace-ispaceipaddr,[xx,xx]space-cspacestart|stopspace--ipspacex1,x2,..space--cmdspacestart|stop"PLYTABprintspace"superstar.pyspace-sspace-Mspacemodulename,[xx,xx]space-cspacestart|stopspace--Modspacemod1,mod2space--cmdspacestart|stop"PLYTABprintspace"superstar.pyspace-sspace-ispaceipaddr,[xx,xx]space-Mspacemodulename,[xx,xx]space-cspacestart|stop"PLYTABprintspace'''---------------------------------------------------------------------------------------PLYForspaceexamples:PLY1spaceforspacegeneralspaceusage:PLYspacespacepythonspacesuperstar.pyspace-aspace-cspacestartPLYspacespacepythonspacesuperstar.pyspace-Mspacelogspace-cspacestartPLYspacespacepythonspacesuperstar.pyspace-ispace192.168.199.117,192.168.199.118space-cspacestartPLYspacespacepythonspacesuperstar.pyspace-ispace192.168.199.117,192.168.199.118space-Mspacelogspace-cspacestartPLY2spaceforspacesuperspaceusage:PLYspacespacepythonspacesuperstar.pyspace-sspace-aspace-cspacestartPLYspacespacepythonspacesuperstar.pyspace-sspace-Mspacelogspace-cspacestartPLYspacespacepythonspacesuperstar.pyspace-sspace-ispace192.168.199.117,192.168.199.118space-cspacestartPLYspacespacepythonspacesuperstar.pyspace-sspace-ispace192.168.199.117,192.168.199.118space-Mspacelogspace-cspacestartPLY---------------------------------------------------------------------------------------\033[0m'''PLYdefspacecheck_Ip(ip):PLYTABhostsspace=space[]PLYTABhosts_okspace=space[]PLYTABiphostspace=spacet.findHosts()PLYTABforspacehspaceinspaceiphost:PLYTABTABhosts.append(str(h[0]))PLYTABipspace=space{}.fromkeys(ip).keys()PLYTABforspaceispaceinspaceip:PLYTABTABifspaceispacenotspaceinspacehosts:PLYTABTABTABprintspace"\033[1;31;40m%sspacenotspaceexist,pleasespacecheck!\033[0m"space%iPLYTABTABTAB#continuePLYTABTABTABsys.exit(3)PLYPLYdefspacecheck_ModName(mod):PLYTABmodnamesspace=space[]PLYTABmodulenamespace=spacet.findModName()PLYTABforspacemspaceinspacemodulename:PLYTABTABmodnames.append(str(m[0]))PLYTABforspacemnspaceinspacemod:PLYTABTABifspacemnspacenotspaceinspacemodnames:PLYTABTABTABprintspace"\033[1;31;40mModNamespace%sspacenotspaceexist,pleasespacecheck!\033[0m"space%mnPLYTABTABTABprintspace30*'*'PLYTABTABTABprintspace"\033[1;33;40mInputspaceReferencespaceModName:\033[0m"spacePLYTABTABTABforspacemspaceinspacemodnames:PLYTABTABTABTABprintspace"\033[1;33;40m%s\033[0m"space%m,PLYTABTABTABsys.exit(3)PLYPLYparserspace=spaceOptionParser(add_help_option=0)PLYparser.add_option("-h",space"--help",spaceaction="callback",spacecallback=helpFunc)PLYparser.add_option("-c",space"--cmd",spaceaction="store",spacetype="string",spacedest="cmd",default="")PLYparser.add_option("-a",space"--all",spaceaction="store_true",spacedest="all")PLYparser.add_option("-i",space"--ip",spaceaction="store",spacetype="string",spacedest="ip",spacedefault="")PLYparser.add_option("-M",space"--Mod",spaceaction="store",spacetype="string",spacedest="modname",spacedefault="")PLYparser.add_option("-m",space"--mid",spaceaction="store",spacetype="string",spacedest="mid",default="")PLYparser.add_option("-s",space"--super",spaceaction="store_true",spacedest="super")PLYparser.add_option("-f",space"--force",spaceaction="store_true",spacedest="killforce")PLYPLY(options,spaceargs)space=spaceparser.parse_args()PLYruncmd=options.cmdPLYrunall=options.allPLYrunip=options.ipPLYrunmod=options.modnamePLYmid=options.midPLYrunsuper=options.superPLYcommandoption=argsPLYkillforce=options.killforcePLYnum=8PLYPLYtspace=spaceSQLClass()PLYPLY#获取数据库中机器的用户名，端口和密码PLYuserInfospace=spacet.findUserPass('zhuser')PLYforspaceispaceinspaceuserInfo:PLYTABuserspace=spacei[0]PLYTABportspace=spaceint(i[1])PLYTABpasswdspace=spacei[2]PLYPLY#启停所有模块函数,传入IP参数启停该机器上所有模块，除supervise进程外。spaceBEGINPLYPLY#启动configcenter模块。PLYdefspacestartAll(ip):PLYTABloginspace=spaceParamikoClass(ip[0],port,user,passwd)PLYTABforspacemdspaceinspacet.findipConfPath(ip[0]):PLYTABTABmodule=md[0].strip().split("/")[-1]PLYTABTABcmd="cdspace%s;bashspacestartAndStop.shspacestartspace%s;exit;"space%(md[0],module)PLYTABTABlogin.cmd_run(cmd)PLYTABTABprintspace"\033[32;1m%sspace:space%sspaceisspaceok\033[0m"space%(ip[0],module)PLYPLY#启动除configcenter之外的所有模块PLYdefspacestartAllother(ip):PLYTABspaceloginspace=spaceParamikoClass(ip[0],port,user,passwd)PLYTABspaceforspacemdspaceinspacet.findipOtherPath(ip[0]):PLYTABTABmodule=md[0].strip().split("/")[-1]PLYTABTABcmd="cdspace%s;bashspacestartAndStop.shspacestartspace%s;exit;"space%(md[0],module)PLYTABTABlogin.cmd_run(cmd)PLYTABTABprintspace"\033[32;1m%sspace:space%sspaceisspaceok\033[0m"space%(ip[0],module)PLYPLY#停掉机器上所有模块PLYdefspacestopAll(ip):PLYTABloginspace=spaceParamikoClass(ip[0],port,user,passwd)PLYTABifspacekillforcespace==spaceTruespace:PLYTABTABstopforce="-9"PLYTABelse:PLYTABTABstopforce=""PLYTABcmd="psspace-ef|grepspace'/home/zhuser/jdk1.7.0_25/bin/java'|grepspace-vspacegrep|awkspace'{printspace$2}'|xargsspacekillspace%sspace"%stopforcePLYTABlogin.cmd_run(cmd)PLYTABprintspace"\033[31;1mspace%sspacehasspacebeenspacekilled.\033[0m"space%(ip[0])PLY#启停所有模块函数spaceENDPLYPLYPLY#启停指定IP地址的函数spaceBEGINPLYdefspacestartfor_specified_ip(ip):PLYTABloginspace=spaceParamikoClass(ip,port,user,passwd)PLYTABforspacemdspaceinspacet.findipConfPath(ip):PLYTABTABmodule=md[0].strip().split("/")[-1]PLYTABTABcmd="cdspace%s;bashspacestartAndStop.shspacestartspace%s;exit;"space%(md[0],module)PLYTABTABlogin.cmd_run(cmd)PLYTABTABprintspace"\033[32;1m%sspace:space%sspaceisspaceok\033[0m"space%(ip,module)PLYTABTABtime.sleep(5)PLYPLYTABforspacemdspaceinspacet.findipOtherPath(ip):PLYTABTABmodule=md[0].strip().split("/")[-1]PLYTABTABcmd="cdspace%s;bashspacestartAndStop.shspacestartspace%s;exit;"space%(md[0],module)PLYTABTABlogin.cmd_run(cmd)PLYTABTABprintspace"\033[32;1m%sspace:space%sspaceisspaceok\033[0m"space%(ip,module)PLYPLYdefspacestopfor_specified_ip(ip):PLYTABloginspace=spaceParamikoClass(ip,port,user,passwd)PLYTABifspacekillforcespace==spaceTruespace:PLYTABTABstopforce="-9"PLYTABelse:PLYTABTABstopforce=""PLYTABcmd="psspace-ef|grepspace'/home/zhuser/jdk1.7.0_25/bin/java'|grepspace-vspacegrep|awkspace'{printspace$2}'|xargsspacekillspace%sspace"%stopforcePLYTABlogin.cmd_run(cmd)PLYTABprintspace"\033[31;1mspace%sspacehasspacebeenspacekilled.\033[0m"space%(ip)PLY#启停指定IP地址的函数spaceBEGINPLYPLY#启动指定模块的函数PLYdefspacestartMod(j):PLYTABipspace=spacej[0]PLYTABmodspace=spacej[1]PLYTABloginspace=spaceParamikoClass(ip,port,user,passwd)PLYTABmodule=mod.strip().split("/")[-1]PLYTAB#cmd="cdspace%s\n/home/zhuser/jdk1.7.0_25/bin/javaspace-jarspace%s.jarspacerecoverspace>spacenohup.outspace2>&1space&\nexit\n"space%(mod,module)PLYTABcmd="cdspace%s;bashspacestartAndStop.shspacestartspace%s;exit;"space%(mod,module)PLYTABlogin.cmd_run(cmd)PLYTABprintspace"\033[32;1m%sspace:space%sspaceisspaceok\033[0m"space%(ip,module)PLY#停止指定模块的函数PLYdefspacestopMod(j):PLYTABloginspace=spaceParamikoClass(j[0],port,user,passwd)PLYTABmodule=j[1].strip().split("/")[-1]PLYTABifspacekillforcespace==spaceTruespace:PLYTABTABstopforce="-9"PLYTABelse:PLYTABTABstopforce=""PLYTABcmd="cdspace%s;bashspacestartAndStop.shspacestopspace%sspace%s;exit;"space%(j[1],module,stopforce)PLYTAB#printspacecmdPLYTABlogin.cmd_run(cmd)PLYTABprintspace"\033[31;1mspace%s:[%s]spacehasspacebeenspacekilled.\033[0m"space%(j[0],module)PLY'''PLY#superspace启动configcenter模块。PLYdefspacesuperstartAll(ip):PLYTABloginspace=spaceParamikoClass(ip[0],port,user,passwd)PLYTABforspacemdspaceinspacet.findipConfPath(ip[0]):PLYTABTABmodule=md[0].strip().split("/")[-1]PLYTABTABcmd="/usr/local/bin/supervisespace/opt/supervise/%sspace>/dev/nullspacespace&"space%(module)PLYTABTABlogin.cmd_run(cmd)PLYTABTABprintspace"\033[32;1m%sspace:Superspace%sspaceisspaceok\033[0m"space%(ip[0],module)PLYPLYdefspacesuperstartAllother(ip):#super方式启动除configcenter之外的服务PLYTABloginspace=spaceParamikoClass(ip[0],port,user,passwd)PLYTABforspacemdspaceinspacet.findipOtherPath(ip[0]):PLYTABTABmodule=md[0].strip().split("/")[-1]PLYTABTABcmd="/usr/local/bin/supervisespace/opt/supervise/%sspace>/dev/nullspacespace&"space%(module)PLYTABTABlogin.cmd_run(cmd)PLYTABTABprintspace"\033[32;1m%sspace:Superspace%sspaceisspaceok\033[0m"space%(ip[0],module)PLYPLYdefspacesuperstopAll(ip):#super方式停止所有PLYTABloginspace=spaceParamikoClass(ip[0],port,user,passwd)PLYTABcmd="psspace-ef|egrepspace'(supervise|/home/zhuser/jdk1.7.0_25/bin/javaspace-jar)'|grepspace-vspacegrep|awkspace'{printspace$2}'|xargsspacekillspace"PLYTABlogin.cmd_run(cmd)PLYTABprintspace"\033[31;1mspace%sspacehasspacebeenspacekilled.\033[0m"space%(ip[0])PLYPLYdefspacesuperstartOnly(ip):#super方式启动指定IP地址PLYTABloginspace=spaceParamikoClass(ip,port,user,passwd)PLYTABforspacemdspaceinspacet.findipConfPath(ip):PLYTABTABmodule=md[0].strip().split("/")[-1]PLYTABTABcmd="/usr/local/bin/supervisespace/opt/supervise/%sspace>/dev/nullspacespace&"space%(module)PLYTABTABlogin.cmd_run(cmd)PLYTABTABprintspace"\033[32;1m%sspace:Superspace%sspaceisspaceok\033[0m"space%(ip[0],module)PLYTABTABtime.sleep(5)PLYPLYTABforspacemdspaceinspacet.findipOtherPath(ip):PLYTABTABmodule=md[0].strip().split("/")[-1]PLYTABTABcmd="/usr/local/bin/supervisespace/opt/supervise/%sspace>/dev/nullspacespace&"space%(module)PLYTABTABlogin.cmd_run(cmd)PLYTABTABprintspace"\033[32;1m%sspace:Superspace%sspaceisspaceok\033[0m"space%(ip,module)PLYPLYdefspacesuperstopOnly(ip):#super方式停止指定IP地址PLYTABloginspace=spaceParamikoClass(ip,port,user,passwd)PLYTABcmd="psspace-ef|egrepspace'(supervise|/home/zhuser/jdk1.7.0_25/bin/javaspace-jar)'|grepspace-vspacegrep|awkspace'{printspace$2}'|xargsspacekillspace"PLYTABlogin.cmd_run(cmd)PLYTABprintspace"\033[31;1mspace%sspacehasspacebeenspacekilled.\033[0m"space%(ip)PLYPLYdefspacesuperrunMod(j):#super方式启动模块PLYTABipspace=spacej[0]PLYTABmodspace=spacej[1]PLYTABloginspace=spaceParamikoClass(ip,port,user,passwd)PLYTABmodule=mod.strip().split("/")[-1]PLYTAB#cmd="cdspace%s\n/home/zhuser/jdk1.7.0_25/bin/javaspace-jarspace%s.jarspace>spacenohup.outspace2>&1space&\nexit\n"space%(mod,module)PLYTABcmd="/usr/local/bin/supervisespace/opt/supervise/%sspace>/dev/nullspacespace&"space%(module)PLYTABlogin.cmd_run(cmd)PLYTABprintspace"\033[32;1m%sspace:Superspace%sspaceisspaceok\033[0m"space%(ip,module)PLYPLYdefspacesuperstopMod(j):#super方式停止模块PLYTABloginspace=spaceParamikoClass(j[0],port,user,passwd)PLYTABmodule=j[1].strip().split("/")[-1]PLYTAB#cmd="psspace-ef|grepspace'/home/zhuser/jdk1.7.0_25/bin/javaspace-jar'|grepspace-vspacegrep|awkspace'{printspace$2}'|xargsspacekillspace"PLYTABcmd="psspace-ef|egrepspace'(supervise|/home/zhuser/jdk1.7.0_25/bin/javaspace-jarspace%s)'|grepspace-vspacegrep|awkspace'{printspace$2}'|xargsspacekillspace"space%(module)PLYTABlogin.cmd_run(cmd)PLYTABprintspace"\033[31;1mspace%s:Superspace[%s]spacehasspacebeenspacekilled.\033[0m"space%(j[0],module)PLYPLYdefspacesuperrunApp():#super方式启停所有的服务PLYTABifspacelen(runcmd)space==space0:PLYTABTABprintspace"\033[31;1mspaceCommandspacecan'tspacebespacenull\033[0m"PLYTABTABsys.exit(3)PLYTABelifspaceruncmdspace==space"start":PLYTABTABforspaceipspaceinspacet.findHosts():PLYTABTABTABsuperstartAll(ip)PLYTABTABtime.sleep(6)PLYTABTABpoolspace=spacemultiprocessing.Pool(processes=num)PLYTABTABforspaceipspaceinspacet.findHosts():PLYTABTABTABpool.apply_async(superstartAllother,(ip,))PLYTABTABpool.close()PLYTABTABpool.join()PLYPLYTABelifspaceruncmdspace==space"stop":PLYTABTABpoolspace=spacemultiprocessing.Pool(processes=num)PLYTABTABforspaceipspaceinspacet.findHosts():PLYTABTABTABpool.apply_async(superstopAll,(ip,))PLYTABTABpool.close()PLYTABTABpool.join()PLYPLYTABelse:PLYTABTABprintspace"wrongspaceargs"PLYPLYdefspacesuperrunOnlyApp():#super方式启停指定IP地址的服务PLYTABifspacelen(runcmd)space==space0:PLYTABTABprintspace"\033[31;1mspaceCommandspacecan'tspacebespacenull\033[0m"PLYTABTABsys.exit(3)PLYTABelifspaceruncmdspace==space"start":PLYTABTABpoolspace=spacemultiprocessing.Pool(processes=num)PLYTABTABforspaceipspaceinspaceinput_ip_list:PLYTABTABTABifspaceipspaceinspaceall_ip_list:PLYTABTABTABTABpool.apply_async(superstartOnly,(ip,))PLYTABTABTABelse:PLYTABTABTABTABprintspace"[\033[33;1m%sspaceisspacenotspaceexist\033[0m]"space%(ip)PLYTABTABpool.close()PLYTABTABpool.join()PLYPLYTABelifspaceruncmdspace==space"stop":PLYTABTABpoolspace=spacemultiprocessing.Pool(processes=num)PLYTABTABforspaceipspaceinspaceinput_ip_list:PLYTABTABTABifspaceipspaceinspaceall_ip_list:PLYTABTABTABTABpool.apply_async(superstopOnly,(ip,))PLYTABTABTABelse:PLYTABTABTABTABprintspace"[\033[33;1m%sspaceisspacenotspaceexist\033[0m]"space%(ip)PLYTABTABpool.close()PLYTABTABpool.join()PLYPLYTABelse:PLYTABTABprintspace"wrongspaceargs"PLY'''PLYPLYdefspacerunApp():#启停所有服务的函数PLYTABifspacelen(runcmd)space==space0:PLYTABTABprintspace"\033[31;1mspaceCommandspacecan'tspacebespacenull\033[0m"PLYTABTABsys.exit(3)PLYTABelifspaceruncmdspace==space"start":PLYTABTABforspaceipspaceinspacet.findHosts():PLYTABTABTABstartAll(ip)PLYTABTABtime.sleep(6)PLYPLYTABTABpoolspace=spacemultiprocessing.Pool(processes=num)PLYTABTABforspaceipspaceinspacet.findHosts():PLYTABTABTABpool.apply_async(startAllother,(ip,))PLYTABTABpool.close()PLYTABTABpool.join()PLYPLYTABelifspaceruncmdspace==space"stop":PLYTABTABpoolspace=spacemultiprocessing.Pool(processes=num)PLYTABTABforspaceipspaceinspacet.findHosts():PLYTABTABTABpool.apply_async(stopAll,(ip,))PLYTABTABpool.close()PLYTABTABpool.join()PLYPLYTABelse:PLYTABTABprintspace"wrongspaceargs"PLYPLYdefspacerun_some():space#指定IP地址启停的函数PLYTABifspacelen(runcmd)space==space0:PLYTABTABprintspace"\033[31;1mspaceCommandspacecan'tspacebespacenull\033[0m"PLYTABTABsys.exit(3)PLYTABelifspaceruncmdspace==space"start":PLYTABTABpoolspace=spacemultiprocessing.Pool(processes=num)PLYTABTABforspaceipspaceinspaceinput_ip_list:PLYTABTABTABifspaceipspaceinspaceall_ip_list:PLYTABTABTABTABpool.apply_async(startfor_specified_ip,(ip,))PLYTABTABTABelse:PLYTABTABTABTABprintspace"[\033[33;1m%sspaceisspacenotspaceexist\033[0m]"space%(ip)PLYTABTABpool.close()PLYTABTABpool.join()PLYPLYTABelifspaceruncmdspace==space"stop":PLYTABTABpoolspace=spacemultiprocessing.Pool(processes=num)PLYTABTABforspaceipspaceinspaceinput_ip_list:PLYTABTABTABifspaceipspaceinspaceall_ip_list:PLYTABTABTABTABpool.apply_async(stopfor_specified_ip,(ip,))PLYTABTABTABelse:PLYTABTABTABTABprintspace"[\033[33;1m%sspaceisspacenotspaceexist\033[0m]"space%(ip)PLYTABTABpool.close()PLYTABTABpool.join()PLYPLYTABelse:PLYTABTABprintspace"wrongspaceargs"PLYPLYpoolspace=spacemultiprocessing.Pool(processes=num)#指定并发进程数量PLYinput_ip_list=runip.strip().split(',')space#获取-i给出的IP地址列表PLYall_ip_list=[]#IP列表PLYinput_mod_list=runmod.strip().split(',')#取出参数中所有的模块PLYsomemod=[]PLYinfolistspace=space[]PLYPLY#检查参数:ip,mod,mid是否合法兼容PLYifspaceinput_ip_listspace!=space['']:PLYTABcheck_Ip(input_ip_list)PLYifspaceinput_mod_listspace!=space['']:PLYTABcheck_ModName(input_mod_list)PLYifspacemidspace!=space"":PLYTABifspacemidspace!=space"head"spaceandspacemidspace!=space"tail":PLYTABTABprintspace"\033[1;31;40mmidspacenotspacecorrect,pleasespacecheck!\033[0m"PLYTABTABsys.exit(3)PLYifspacelen(input_mod_list)space!=space1spaceandspacemidspace!=space"":PLYTABprintspace"\033[1;31;40mmidspaceandspaceseveralspacemodulesspacecannotspaceusespacetogether,pleasespacemodify!\033[0m"PLYTABsys.exit(3)PLYPLYifspaceinput_ip_listspace!=space['']spaceandspacemidspace!=space"":PLYTABprintspace"\033[1;31;40mmidspaceandspaceipspacecannotspaceusespacetogether,pleasespacemodify!\033[0m"PLYTABsys.exit(3)PLYPLY#普通模式(不带supervise)PLYifspacerunsuperspace!=spaceTrue:PLYTABifspacelen(input_mod_list[0])space!=space0spaceandspacespaceruncmdspace==space"start"spaceandspacelen(input_ip_list[0])space!=space0:#如果指定了IP地址，命令start和模块名。PLYTABTABforspacespaceipspaceinspaceinput_ip_list:PLYTABTABTABforspacemodspaceinspaceinput_mod_list:PLYTABTABTABTABsomemod.append(t.QTfindPath(mod,ip))PLYTABTABforspacewspaceinspacesomemod:PLYTABTABTABforspacejspaceinspacew:PLYTABTABTABTABinfolist.append(j)PLYTABTABifspaceinfolistspace!=space[]:PLYTABTABTABmodlenspace=spacespacelen(infolist)PLYTABTABTABcountspace=spacemodlen/2PLYTABTABTABlinfospace=spacemodlen%2PLYTABTABTABifspacelinfospace!=space0:PLYTABTABTABTABcountspace=spacecount+1PLYTABTABTABifspacemidspace==space"head":PLYTABTABTABTABispace=space0PLYTABTABTABTABwhilespaceispace<spacecount:PLYTABTABTABTABTABpool.apply_async(startMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelifspacemidspace==space"tail":PLYTABTABTABTABispace=spacecountPLYTABTABTABTABwhilespaceispace<spacemodlen:PLYTABTABTABTABTABpool.apply_async(startMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelse:TABTABPLYTABTABTABTABforspaceispaceinspaceinfolist:PLYTABTABTABTABTABpool.apply_async(startMod,(i,))PLYTABTABTABpool.close()PLYTABTABTABpool.join()PLYTABTABelse:PLYTABTABTABprint('Error!pleasespacecheckspacedbspacefile!!')PLYPLYTABelifspacelen(input_mod_list[0])space!=space0spaceandspacespaceruncmdspace==space"stop"spaceandspacelen(input_ip_list[0])space!=space0:#如果指定了IP地址，命令stop和模块名。PLYTABTABforspacespaceipspaceinspaceinput_ip_list:PLYTABTABTABforspacemodspaceinspaceinput_mod_list:PLYTABTABTABTABsomemod.append(t.QTfindPath(mod,ip))PLYTABTABforspacewspaceinspacesomemod:PLYTABTABTABforspacejspaceinspacew:PLYTABTABTABTABinfolist.append(j)PLYTABTABifspaceinfolistspace!=space[]:PLYTABTABTABmodlenspace=spacespacelen(infolist)PLYTABTABTABcountspace=spacemodlen/2PLYTABTABTABlinfospace=spacemodlen%2PLYTABTABTABifspacelinfospace!=space0:PLYTABTABTABTABcountspace=spacecount+1PLYTABTABTABifspacemidspace==space"head":PLYTABTABTABTABispace=space0PLYTABTABTABTABwhilespaceispace<spacecount:PLYTABTABTABTABTABpool.apply_async(stopMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelifspacemidspace==space"tail":PLYTABTABTABTABispace=spacecountPLYTABTABTABTABwhilespaceispace<spacemodlen:PLYTABTABTABTABTABpool.apply_async(stopMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelse:TABTABPLYTABTABTABTABforspaceispaceinspaceinfolist:PLYTABTABTABTABTABpool.apply_async(stopMod,(i,))PLYTABTABTABpool.close()PLYTABTABTABpool.join()PLYTABTABelse:PLYTABTABTABprint('Error!pleasespacecheckspacedbspacefile!!')PLYPLYTABelifspacelen(input_mod_list[0])space!=space0spaceandspacespaceruncmdspace==space"start":#如果指定了模块名字和命令start。PLYTABTABforspaceispaceinspaceinput_mod_list:PLYTABTABTABforspacejspaceinspacet.QTfindIp(i):PLYTABTABTABTABinfolist.append(j)PLYTABTABifspaceinfolistspace!=space[]:PLYTABTABTABmodlenspace=spacespacelen(infolist)PLYTABTABTABcountspace=spacemodlen/2PLYTABTABTABlinfospace=spacemodlen%2PLYTABTABTABifspacelinfospace!=space0:PLYTABTABTABTABcountspace=spacecount+1PLYTABTABTABifspacemidspace==space"head":PLYTABTABTABTABispace=space0PLYTABTABTABTABwhilespaceispace<spacecount:PLYTABTABTABTABTABpool.apply_async(startMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelifspacemidspace==space"tail":PLYTABTABTABTABispace=spacecountPLYTABTABTABTABwhilespaceispace<spacemodlen:PLYTABTABTABTABTABpool.apply_async(startMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelse:TABTABPLYTABTABTABTABforspaceispaceinspaceinfolist:PLYTABTABTABTABTABpool.apply_async(startMod,(i,))PLYTABTABTABpool.close()PLYTABTABTABpool.join()PLYTABTABelse:PLYTABTABTABprint('Error!pleasespacecheckspacedbspacefile!!')PLYPLYTABelifspacelen(input_mod_list[0])space!=space0spaceandspacespaceruncmdspace==space"stop":#如果指定了模块名字和命令stop。PLYTABTABforspaceispaceinspaceinput_mod_list:PLYTABTABTABforspacejspaceinspacet.QTfindIp(i):PLYTABTABTABTABinfolist.append(j)PLYTABTABifspaceinfolistspace!=space[]:PLYTABTABTABmodlenspace=spacespacelen(infolist)PLYTABTABTABcountspace=spacemodlen/2PLYTABTABTABlinfospace=spacemodlen%2PLYTABTABTABifspacelinfospace!=space0:PLYTABTABTABTABcountspace=spacecount+1PLYTABTABTABifspacemidspace==space"head":PLYTABTABTABTABispace=space0PLYTABTABTABTABwhilespaceispace<spacecount:PLYTABTABTABTABTABpool.apply_async(stopMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelifspacemidspace==space"tail":PLYTABTABTABTABispace=spacecountPLYTABTABTABTABwhilespaceispace<spacemodlen:PLYTABTABTABTABTABpool.apply_async(stopMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelse:TABTABPLYTABTABTABTABforspaceispaceinspaceinfolist:PLYTABTABTABTABTABpool.apply_async(stopMod,(i,))PLYTABTABTABpool.close()PLYTABTABTABpool.join()PLYTABTABelse:PLYTABTABTABprint('Error!pleasespacecheckspacedbspacefile!!')PLYPLYTABelifspacelen(input_ip_list[0])space!=space0space:space#只指定IP地址PLYTABTABforspaceispaceinspacet.findHosts():PLYTABTABTABall_ip_list.append(str(i[0]))PLYTABTABrun_some()PLYPLYTABelifspacerunallspace==spaceTrue:#指定-a，runall为true，执行所有操作PLYTABTABrunApp()PLYPLYTABelse:PLYTABTABhelpFunc('a','b','c','d')PLY"""PLYelse:PLYPLY#进入supervisespace模块式PLYTABifspacelen(input_mod_list[0])space!=space0spaceandspacespaceruncmdspace==space"start"spaceandspacelen(input_ip_list[0])space!=space0:#如果指定了IP地址，命令start和模块名。PLYTABTABforspacespaceipspaceinspaceinput_ip_list:PLYTABTABTABforspacemodspaceinspaceinput_mod_list:PLYTABTABTABTABsomemod.append(t.QTfindPath(mod,ip))PLYTABTABforspacewspaceinspacesomemod:PLYTABTABTABforspacejspaceinspacew:PLYTABTABTABTABinfolist.append(j)PLYTABTABifspaceinfolistspace!=space[]:PLYTABTABTABmodlenspace=spacespacelen(infolist)PLYTABTABTABcountspace=spacemodlen/2PLYTABTABTABlinfospace=spacemodlen%2PLYTABTABTABifspacelinfospace!=space0:PLYTABTABTABTABcountspace=spacecount+1PLYTABTABTABifspacemidspace==space"head":PLYTABTABTABTABispace=space0PLYTABTABTABTABwhilespaceispace<spacecount:PLYTABTABTABTABTABpool.apply_async(superrunMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelifspacemidspace==space"tail":PLYTABTABTABTABispace=spacecountPLYTABTABTABTABwhilespaceispace<spacemodlen:PLYTABTABTABTABTABpool.apply_async(superrunMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelse:TABTABPLYTABTABTABTABforspaceispaceinspaceinfolist:PLYTABTABTABTABTABpool.apply_async(superrunMod,(i,))PLYTABTABTABpool.close()PLYTABTABTABpool.join()PLYTABTABelse:PLYTABTABTABprint('Error!pleasespacecheckspacedbspacefile!!')PLYPLYTABelifspacelen(input_mod_list[0])space!=space0spaceandspacespaceruncmdspace==space"stop"spaceandspacelen(input_ip_list[0])space!=space0:#如果指定了IP地址,命令stop和模块名。PLYTABTABforspacespaceipspaceinspaceinput_ip_list:PLYTABTABTABforspacemodspaceinspaceinput_mod_list:PLYTABTABTABTABsomemod.append(t.QTfindPath(mod,ip))PLYTABTABforspacewspaceinspacesomemod:PLYTABTABTABforspacejspaceinspacew:PLYTABTABTABTABinfolist.append(j)PLYTABTABifspaceinfolistspace!=space[]:PLYTABTABTABmodlenspace=spacespacelen(infolist)PLYTABTABTABcountspace=spacemodlen/2PLYTABTABTABlinfospace=spacemodlen%2PLYTABTABTABifspacelinfospace!=space0:PLYTABTABTABTABcountspace=spacecount+1PLYTABTABTABifspacemidspace==space"head":PLYTABTABTABTABispace=space0PLYTABTABTABTABwhilespaceispace<spacecount:PLYTABTABTABTABTABpool.apply_async(superstopMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelifspacemidspace==space"tail":PLYTABTABTABTABispace=spacecountPLYTABTABTABTABwhilespaceispace<spacemodlen:PLYTABTABTABTABTABpool.apply_async(superstopMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelse:TABTABPLYTABTABTABTABforspaceispaceinspaceinfolist:PLYTABTABTABTABTABpool.apply_async(superstopMod,(i,))PLYTABTABTABpool.close()PLYTABTABTABpool.join()PLYTABTABelse:PLYTABTABTABprint('Error!pleasespacecheckspacedbspacefile!!')PLYPLYTABelifspacelen(input_mod_list[0])space!=space0spaceandspacespaceruncmdspace==space"start":#只指定了模块名和start命令PLYTABTABforspaceispaceinspaceinput_mod_list:PLYTABTABTABforspacejspaceinspacet.QTfindIp(i):PLYTABTABTABTABinfolist.append(j)PLYTABTABifspaceinfolistspace!=space[]:PLYTABTABTABmodlenspace=spacespacelen(infolist)PLYTABTABTABcountspace=spacemodlen/2PLYTABTABTABlinfospace=spacemodlen%2PLYTABTABTABifspacelinfospace!=space0:PLYTABTABTABTABcountspace=spacecount+1PLYTABTABTABifspacemidspace==space"head":PLYTABTABTABTABispace=space0PLYTABTABTABTABwhilespaceispace<spacecount:PLYTABTABTABTABTABpool.apply_async(superrunMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelifspacemidspace==space"tail":PLYTABTABTABTABispace=spacecountPLYTABTABTABTABwhilespaceispace<spacemodlen:PLYTABTABTABTABTABpool.apply_async(superrunMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelse:TABTABPLYTABTABTABTABforspaceispaceinspaceinfolist:PLYTABTABTABTABTABpool.apply_async(superrunMod,(i,))PLYTABTABTABpool.close()PLYTABTABTABpool.join()PLYTABTABelse:PLYTABTABTABprint('Error!pleasespacecheckspacedbspacefile!!')PLYPLYTABelifspacelen(input_mod_list[0])space!=space0spaceandspacespaceruncmdspace==space"stop":#只指定了模块名和stop命令PLYTABTABforspaceispaceinspaceinput_mod_list:PLYTABTABTABforspacejspaceinspacet.QTfindIp(i):PLYTABTABTABTABinfolist.append(j)PLYTABTABifspaceinfolistspace!=space[]:PLYTABTABTABmodlenspace=spacespacelen(infolist)PLYTABTABTABcountspace=spacemodlen/2PLYTABTABTABlinfospace=spacemodlen%2PLYTABTABTABifspacelinfospace!=space0:PLYTABTABTABTABcountspace=spacecount+1PLYTABTABTABifspacemidspace==space"head":PLYTABTABTABTABispace=space0PLYTABTABTABTABwhilespaceispace<spacecount:PLYTABTABTABTABTABpool.apply_async(superstopMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelifspacemidspace==space"tail":PLYTABTABTABTABispace=spacecountPLYTABTABTABTABwhilespaceispace<spacemodlen:PLYTABTABTABTABTABpool.apply_async(superstopMod,(infolist[i],))PLYTABTABTABTABTABispace=spacei+1PLYTABTABTABelse:TABTABPLYTABTABTABTABforspaceispaceinspaceinfolist:PLYTABTABTABTABTABpool.apply_async(superstopMod,(i,))PLYTABTABTABpool.close()PLYTABTABTABpool.join()PLYTABTABelse:PLYTABTABTABprint('Error!pleasespacecheckspacedbspacefile!!')PLYPLYPLYTABelifspacelen(input_ip_list[0])space!=space0space:space#如果只指定IP地址PLYTABTABforspaceispaceinspacet.findHosts():PLYTABTABTABall_ip_list.append(str(i[0]))PLYTABTABsuperrunOnlyApp()PLYPLYTABelifspacerunallspace==spaceTrue:#指定-aspacerunall为true，执行所有操作PLYTABTABsuperrunApp()PLYPLYTABelse:PLYTABTABhelpFunc('a','b','c','d')PLY"""PLY
